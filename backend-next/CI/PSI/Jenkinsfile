node {
       stage('Checkout'){
          checkout scm
       }
       stage('Preprepare Docker with config files'){
            withCredentials([usernamePassword(credentialsId: 'git', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                // available as an env variable, but will be masked if you try to print it out any which way
                // also available as a Groovy variableâ€”note double quotes for string interpolation
                echo "$USERNAME"
                echo "$PASSWORD"
                sh "git clone https://$USERNAME:$PASSWORD@git.psi.ch/MELANIE/catamel-psisecrets.git"
                sh "git clone https://$USERNAME:$PASSWORD@git.psi.ch/MELANIE/catamel-psiconfig.git"
                sh "mkdir -p /usr/src/app"
                sh "cp catamel-psisecrets/server/pass-db-qa/datasources.json server/datasources.json"
                sh "cp catamel-psisecrets/server/providers.json /usr/src/app/server/providers.json"
                sh "cp catamel-psiconfig/server/config.local.js /usr/src/app/server/config.local.js"
                sh "cp -r catamel-psiconfig/server/kubernetes/helm/dacat-api-server/envfiles-qa/ /usr/src/app/server/"
            }
       }
       stage('Build Docker') {
            sh 'ls -ahl server/'
            sh 'docker build -f CI/PSI/Dockerfile.test . -t catamel_test'
       }
       stage('SuperTest Catamel ') {
            sh 'docker run  --privileged -t catamel_test npm run test'
       }

}
