FROM smebberson/alpine-nginx-nodejs
EXPOSE 80

RUN mkdir /catamel
WORKDIR /catamel


COPY package.json .
RUN npm i

COPY src src
COPY angular-cli.json .

ARG APP_PROD='true'
ARG LB_BASE_URL='http://localhost/api'
ARG LB_API_VERSION=''

RUN echo "export const environment = { \
  production: $APP_PROD, \
  lbBaseURL: '$LB_BASE_URL', \
  lbApiVersion: '$LB_API_VERSION' \
};" > src/environments/environment.docker.ts

RUN ./node_modules/@angular/cli/bin/ng build --environment=docker
RUN mv dist/* /usr/html