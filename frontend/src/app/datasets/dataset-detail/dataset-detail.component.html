<ng-template [ngIf]="dataset">
  <div fxLayout="row" fxLayout.xs="column">
    <div fxFlex="80%">
      <mat-card style="margin: 1em">
        <mat-card-header style="background:#7de1ff;">
          About the data
        </mat-card-header>

        <table>
          <tr *ngIf="dataset.datasetName as value">
            <th><mat-icon> fingerprint </mat-icon> Name</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.description as value">
            <th><mat-icon> description </mat-icon> Description</th>
            <td><span [innerHTML]="value | linky"></span></td>
          </tr>
          <tr *ngIf="dataset.owner as value">
            <th><mat-icon> person </mat-icon> Owner</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.keywords as keywords">
            <th><mat-icon> vpn_key </mat-icon> Keywords</th>
            <td>
              <mat-chip-list>
                <div *ngIf="keywords.length > 0">
                  <span *ngFor="let keyword of keywords">
                    <mat-chip (click)="onClickKeyword(keyword)">
                      {{ keyword }}
                    </mat-chip>
                  </span>
                </div>
                <div *ngIf="keywords.length === 0">
                  <mat-chip disabled>No Keywords</mat-chip>
                </div>
              </mat-chip-list>
            </td>
          </tr>
          <tr>
            <th><mat-icon> perm_contact_calendar </mat-icon> PID</th>
            <td>{{ dataset.pid }}</td>
          </tr>
          <tr *ngIf="dataset.sourceFolder as value">
            <th><mat-icon> folder </mat-icon> Source Folder</th>
            <td>{{ value }}</td>
          </tr>
        </table>
      </mat-card>

      <mat-card style="margin: 1em">
        <mat-card-header style="background:#d2f082;">
          Structural information
        </mat-card-header>

        <table>
          <tr *ngIf="dataset.type as value">
            <th><mat-icon> bubble_chart </mat-icon> Type</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.version as value">
            <th><mat-icon> map </mat-icon> Version</th>
            <td>{{ value }}</td>
          </tr>
          <tr
            *ngIf="dataset.proposalId as value"
            (click)="onClickProposal(value)"
          >
            <th><mat-icon> spa </mat-icon> Proposal</th>
            <td>
              <a class="related-link">{{ value }}</a>
            </td>
          </tr>
          <tr *ngIf="dataset.sampleId as value" (click)="onClickSample(value)">
            <th><mat-icon> center_focus_weak </mat-icon> Sample</th>
            <td>
              <a class="related-link">{{ value }}</a>
            </td>
          </tr>
          <tr *ngIf="dataset.size as value">
            <th><mat-icon> save </mat-icon> Size</th>
            <td>{{ value | filesize }}</td>
          </tr>
          <tr *ngIf="dataset.orcidOfOwner as value">
            <th><mat-icon> local_florist </mat-icon> Orcid</th>
            <td><span [innerHTML]="value | linky"></span></td>
          </tr>
        </table>
      </mat-card>

      <mat-card style="margin: 1em">
        <mat-card-header style="background:#ff6e6e;">
          Administrative information
        </mat-card-header>

        <table>
          <tr *ngIf="dataset.creationTime as value">
            <th><mat-icon> calendar_today </mat-icon> Creation Time</th>
            <td>{{ value | date: "yyyy-MM-dd HH:mm" }}</td>
          </tr>
          <tr *ngIf="dataset.principalInvestigator as value">
            <th><mat-icon> brightness_5 </mat-icon> Principal Investigator</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.creationLocation as value">
            <th><mat-icon> map </mat-icon> Creation Location</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.ownerGroup as value">
            <th><mat-icon> group </mat-icon> Owner Group</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.contactEmail as value">
            <th><mat-icon> email </mat-icon> Contact Email</th>
            <td><span [innerHTML]="value | linky"></span></td>
          </tr>
        </table>
      </mat-card>

      <mat-card style="margin:1em" *ngIf="dataset.investigator">
        <mat-card-header style="background:#d2b478;">
          Derived Data
        </mat-card-header>

        <table>
          <tr *ngIf="dataset.investigator as value">
            <th><mat-icon> school </mat-icon> Investigator</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.inputDatasets as value">
            <th><mat-icon> input </mat-icon> Input Datasets</th>
            <td>
              <div *ngFor="let datasetPid of value">
                <span>
                  <a [routerLink]="['/datasets/', datasetPid]">
                    {{ datasetPid }}
                  </a>
                </span>
                <span *ngIf="value.indexOf(datasetPid) < value.length - 1"
                  >,
                </span>
              </div>
            </td>
          </tr>
          <tr *ngIf="dataset.usedSoftware as value">
            <th><mat-icon> screen_share</mat-icon> Software Used</th>
            <td>{{ value }}</td>
          </tr>
          <tr *ngIf="dataset.jobParameters as value">
            <th><mat-icon> settings </mat-icon> Job Parameters</th>
            <td>{{ value | json }}</td>
          </tr>
          <tr *ngIf="dataset.jobLogData as value">
            <th><mat-icon> ballot </mat-icon> Job Log Data</th>
            <td>{{ value }}</td>
          </tr>
        </table>
      </mat-card>

      <mat-card style="margin:1em">
        <mat-card-header style="background:#ff96fa;">
          Scientific Metadata
        </mat-card-header>

        <ng-template
          [ngIf]="appConfig.tableSciDataEnabled"
          [ngIfElse]="jsonview"
        >
          <mat-tab-group>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon> list </mat-icon> View
              </ng-template>
              <app-metadata-table></app-metadata-table>
            </mat-tab>
            <mat-tab *ngIf="appConfig.editMetadataEnabled">
              <ng-template mat-tab-label>
                <mat-icon> edit </mat-icon> Edit
              </ng-template>
              <app-dataset-form></app-dataset-form>
            </mat-tab>
          </mat-tab-group>
        </ng-template>

        <ng-template #jsonview>
          <ngx-json-viewer
            [json]="dataset.scientificMetadata"
            [expanded]="false"
          ></ngx-json-viewer>
        </ng-template>
      </mat-card>

      <mat-card style="margin:1em">
        <button mat-stroked-button (click)="show = !show">
          {{ show ? "Hide MetaData" : "Show Metadata" }}
        </button>

        <br />

        <div *ngIf="show">
          <ngx-json-viewer
            [json]="datasetwithout"
            [expanded]="false"
          ></ngx-json-viewer>
        </div>
      </mat-card>
    </div>

    <div fxFlex="30%" *ngIf="attachments">
      <ng-container *ngFor="let da of attachments">
        <mat-card style="margin: 1em">
          <img mat-card-image src="{{ da.thumbnail }}" />
          <p>{{ da.caption }}</p>
        </mat-card>
      </ng-container>
    </div>
  </div>
</ng-template>
